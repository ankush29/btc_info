{"ast":null,"code":"'use strict';\n\nvar RingBuffer = require('./ring_buffer');\n\nvar Pledge = function Pledge() {\n  this._complete = false;\n  this._callbacks = new RingBuffer(Pledge.QUEUE_SIZE);\n};\n\nPledge.QUEUE_SIZE = 4;\n\nPledge.all = function (list) {\n  var pledge = new Pledge(),\n      pending = list.length,\n      n = pending;\n  if (pending === 0) pledge.done();\n\n  while (n--) {\n    list[n].then(function () {\n      pending -= 1;\n      if (pending === 0) pledge.done();\n    });\n  }\n\n  return pledge;\n};\n\nPledge.prototype.then = function (callback) {\n  if (this._complete) callback();else this._callbacks.push(callback);\n};\n\nPledge.prototype.done = function () {\n  this._complete = true;\n  var callbacks = this._callbacks,\n      callback;\n\n  while (callback = callbacks.shift()) {\n    callback();\n  }\n};\n\nmodule.exports = Pledge;","map":null,"metadata":{},"sourceType":"script"}