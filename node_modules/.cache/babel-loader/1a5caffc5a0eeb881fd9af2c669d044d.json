{"ast":null,"code":"// API references:\n//\n// * http://dev.w3.org/html5/websockets/\n// * http://dvcs.w3.org/hg/domcore/raw-file/tip/Overview.html#interface-eventtarget\n// * http://dvcs.w3.org/hg/domcore/raw-file/tip/Overview.html#interface-event\nvar util = require('util'),\n    driver = require('websocket-driver'),\n    API = require('./websocket/api');\n\nvar WebSocket = function WebSocket(request, socket, body, protocols, options) {\n  options = options || {};\n  this._stream = socket;\n  this._driver = driver.http(request, {\n    maxLength: options.maxLength,\n    protocols: protocols\n  });\n  var self = this;\n  if (!this._stream || !this._stream.writable) return;\n  if (!this._stream.readable) return this._stream.end();\n\n  var catchup = function catchup() {\n    self._stream.removeListener('data', catchup);\n  };\n\n  this._stream.on('data', catchup);\n\n  API.call(this, options);\n  process.nextTick(function () {\n    self._driver.start();\n\n    self._driver.io.write(body);\n  });\n};\n\nutil.inherits(WebSocket, API);\n\nWebSocket.isWebSocket = function (request) {\n  return driver.isWebSocket(request);\n};\n\nWebSocket.validateOptions = function (options, validKeys) {\n  driver.validateOptions(options, validKeys);\n};\n\nWebSocket.WebSocket = WebSocket;\nWebSocket.Client = require('./websocket/client');\nWebSocket.EventSource = require('./eventsource');\nmodule.exports = WebSocket;","map":null,"metadata":{},"sourceType":"script"}